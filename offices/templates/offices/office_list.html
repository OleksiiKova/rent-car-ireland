{% extends "base.html" %}

{% block content %}
<div class="container mt-3 px-4">
    <h2 class="text-center">Our Locations</h2>
    <div class="row mt-3">
        <div class="col-12 text-center">
            <select id="officeSelect" class="form-select">
                {% for office in object_list %}
                <option value="{{ office.id }}" data-name="{{ office.name }}" data-phone="{{ office.phone_number }}"
                    data-opening="{{ office.opening_time }}" data-closing="{{ office.closing_time }}"
                    data-lat="{{ office.latitude }}" data-lng="{{ office.longitude }}"
                    {% if office.name == "Dublin Airport" %} selected {% endif %}>
                    {{ office.name }}
                </option>
                {% endfor %}
            </select>
        </div>
    </div>
    <div class="row mt-3" id="officeInformation">
        <div class="col-lg-4 text-center text-lg-start">
            <p class="mb-0" id="officeName"></p>
        </div>
        <div class="col-lg-4 text-center">
            <p class="mb-0" id="officePhone">
            </p>
        </div>
        <div class="col-lg-4 text-center text-lg-end">
            <p class="mb-0" id="officeHours">
            </p>
        </div>
    </div>
    <div class="row mt-3">
        <div id="map"></div>
    </div>
    <div class="row mt-3">
        <div class="col-12 text-center">
            <a id="googleMapLink" href="#" target="_blank">Open in Google Maps</a>
        </div>
    </div>
</div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script>
    document.addEventListener('DOMContentLoaded', function () {
        const officeSelect = document.getElementById('officeSelect');
        let defaultLat, defaultLng;

        // Find the option with "Dublin Airport" and set it as selected
        for (let i = 0; i < officeSelect.options.length; i++) {
            const option = officeSelect.options[i];
            if (option.getAttribute('data-name') === 'Dublin Airport') {
                officeSelect.selectedIndex = i;
                defaultLat = parseFloat(option.getAttribute('data-lat'));
                defaultLng = parseFloat(option.getAttribute('data-lng'));
                break;
            }
        }

        const map = L.map('map').setView([defaultLat, defaultLng], 10);

        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
        }).addTo(map);

        const marker = L.marker([defaultLat, defaultLng]).addTo(map);

        function updateOfficeInfo() {
            const selectedOption = officeSelect.options[officeSelect.selectedIndex];
            const name = selectedOption.getAttribute('data-name');
            const phone = selectedOption.getAttribute('data-phone');
            const opening = selectedOption.getAttribute('data-opening');
            const closing = selectedOption.getAttribute('data-closing');
            const lat = parseFloat(selectedOption.getAttribute('data-lat'));
            const lng = parseFloat(selectedOption.getAttribute('data-lng'));

            document.getElementById('officeName').textContent = name;
            document.getElementById('officePhone').textContent = phone;
            document.getElementById('officeHours').textContent = `Mon - Sun: ${opening} - ${closing}`;

            if (!isNaN(lat) && !isNaN(lng)) {
                map.setView([lat, lng], 15);
                marker.setLatLng([lat, lng]);
                const googleMapLink = `https://www.google.com/maps?q=${lat},${lng}`;
                document.getElementById('googleMapLink').href = googleMapLink;
                document.getElementById('googleMapLink').textContent = `Open in Google Maps`;
            }
        }

        officeSelect.addEventListener('change', updateOfficeInfo);

        // Update info for the initially selected office
        updateOfficeInfo();
    });
</script>
{% endblock %}